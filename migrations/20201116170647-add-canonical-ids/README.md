# Migration `20201116170647-add-canonical-ids`

This migration has been generated by Giorgio Delgado at 11/16/2020, 12:06:47 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "comments" ADD COLUMN     "anon_author_name" TEXT NOT NULL

ALTER TABLE "posts" ADD COLUMN     "url_slug" TEXT NOT NULL

CREATE UNIQUE INDEX "comments.anon_author_name_unique" ON "comments"("anon_author_name")

CREATE UNIQUE INDEX "posts.url_slug_unique" ON "posts"("url_slug")

CREATE UNIQUE INDEX "sites.hostname_unique" ON "sites"("hostname")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201006145004-give-verified-default-value..20201116170647-add-canonical-ids
--- datamodel.dml
+++ datamodel.dml
@@ -1,74 +1,79 @@
 // https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
-  output = "./src/prisma-client"
+  output   = "./node_modules/.prisma/client"
 }
 model Admin {
-  @@map("admins")
-  id         String @id @default(cuid()) 
-  email      String @unique
-  username   String @unique
+  id         String   @id @default(cuid())
+  email      String   @unique
+  username   String   @unique
   password   String
   sites      Site[]
   created_at DateTime @default(now())
   updated_at DateTime @updatedAt
+
+  @@map("admins")
 }
-
 model Site {
-  @@map("sites")
-  id       String @id @default(cuid())
-  hostname String
-  verified Boolean @default(false)
-  dns_tag  String @unique @default(uuid())
-  admin    Admin @relation(fields: [admin_id], references: [id])
-  admin_id String 
-  posts    Post[]
+  id         String   @id @default(cuid())
+  hostname   String   @unique
+  verified   Boolean  @default(false)
+  dns_tag    String   @unique @default(uuid())
+  admin      Admin    @relation(fields: [admin_id], references: [id])
+  admin_id   String
+  posts      Post[]
   created_at DateTime @default(now())
   updated_at DateTime @updatedAt
+
+  @@map("sites")
 }
-
 model User {
-  @@map("users")
-  id         String @id @default(cuid())
-  email      String @unique
-  username   String @unique
+  id         String    @id @default(cuid())
+  email      String    @unique
+  username   String    @unique
   password   String
   comments   Comment[]
-  created_at DateTime @default(now())
-  updated_at DateTime @updatedAt
+  created_at DateTime  @default(now())
+  updated_at DateTime  @updatedAt
+
+  @@map("users")
 }
+model Comment {
+  id               String   @id @default(cuid())
+  parent           Comment? @relation("CommentToComment", fields: [commentId], references: [id])
+  author           User?    @relation(fields: [userId], references: [id])
+  anon_author_name String   @unique
+  body             String   @default("")
+  votes            Int      @default(0)
+  post             Post     @relation(fields: [post_id], references: [id])
+  post_id          String
+  created_at       DateTime @default(now())
+  updated_at       DateTime @updatedAt
-model Comment {
   @@map("comments")
-  id         String @id @default(cuid())
-  parent     Comment?
-  author     User?
-  body       String @default("")
-  votes      Int @default(0)
-  post       Post @relation(fields: [post_id], references: [id])
-  post_id    String
-  created_at DateTime @default(now())
-  updated_at DateTime @updatedAt
+  Comment   Comment[] @relation("CommentToComment")
+  commentId String?
+  userId    String?
 }
-
 model Post {
-  @@map("posts")
-  id         String @id @default(cuid())
-  site       Site @relation(fields: [site_id], references: [id])
+  id         String    @id @default(cuid())
+  url_slug   String    @unique
+  site       Site      @relation(fields: [site_id], references: [id])
   site_id    String
   comments   Comment[]
-  created_at DateTime @default(now())
-  updated_at DateTime @updatedAt
+  created_at DateTime  @default(now())
+  updated_at DateTime  @updatedAt
+
+  @@map("posts")
 }
-
```


